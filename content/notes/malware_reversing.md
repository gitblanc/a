---
title: Malware Reversing 🐉
---
*I will use Ghidra in this note*
## Analyzing functions

- Sometimes you can find flags inside a function in plain text just by observing the **Decompiler** (open in `Window >> Decompiler`):

![](Pasted%20image%2020240418205913.png)

![](Pasted%20image%2020240418205932.png)

---

- If you find a lot of variables predefined on a function as follows:

![](Pasted%20image%2020240418210159.png)

- You can see that the first one is a `char` whereas the last one is a `pointer`. If we look at the dis-assembler section, we can get an idea about how these variables are added to the stack. We can clearly see a reverse order.

![](Pasted%20image%2020240418210441.png)

- The last char pointer which is **local_8** is the first one added to the stack as follows.
- We can see that each variable is assigned a value as follows. The first char variable which is **local_2c** is assigned to ‘**F**’ and all the undefined variables are assigned hex values.

![](Pasted%20image%2020240418210540.png)

- So now, we know that ==these hex values should be ASCII characters because each value is exactly one byte==.
- If you remember, we found that the last variable defined which is local_8, is a character pointer. Now, it is assigned to be a **hash of the string** starting at the memory address of the variable **char local_2c**, as follows.

![](Pasted%20image%2020240418210725.png)

- This means that it will hash the entire string from **bottom of the stack** to **top**. Thus, we need to **convert** each hex character assigned for the variables after **local_2c** into ASCII characters in order to obtain the string that is being hashed.
- You can use [hex-to-ascii converter](https://www.rapidtables.com/convert/number/hex-to-ascii.html) for this purpose. You will be given the flag in ASCII.

---

- As you can see, there are some external functions called such as **FindResourceA()** and **LoadStringsA()**. When we look at the assembly code, we can come across that FindResourceA() is from the Kernel32 Library and LoadStringsA() is from User32 Library.

![](Pasted%20image%2020240418210942.png)

![](Pasted%20image%2020240418211007.png)

![](Pasted%20image%2020240418211021.png)

- What LoadStringsA() does is that it loads the string from its reference and stores at the variable **local_4a4.** So, let us find the reference.
- As shown in the above entry function, we know that **0x110** hex value parameter is the identifier for the string in LoadStringsA() function call.
- Hex 0x110 = Decimal **272**
- Open **Defined Strings** from Ghidra ribbon (Window >> Defined Strings). Scroll down and you will come across a FLAG table which contains many flags.

![](Pasted%20image%2020240418211141.png)

- Take a look at the equivalent code on dis-assembler and you will find-out the **string-ID** at the far right corner in decimal. So, scroll down until you find the string-ID 272.

![](Pasted%20image%2020240418211225.png)

---
